<!DOCTYPE HTML>
<HTML>
<HEAD>
    <META content="IE=edge" http-equiv="X-UA-Compatible">

    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META http-equiv="X-UA-Compatible" content="IE=edge">
    <LINK href="PerMonth.css" rel="STYLESHEET" type="text/css">
    <SCRIPT language="JavaScript" type="text/javascript">
        var object = null;
        var colorname = null;
        var engine = null;
        function bodyOnLoad() {
            returnIEVersion();
            var HTMLContent = document.getElementById("HTMLContent").innerText;     //达梦返回的考勤数据
            var Ornament = document.getElementById("Ornament").innerText;           //工作日和异常文档详情
            var DaysContent = HTMLContent.split(";");                               //每一天的打卡数据
            var dateStr = DaysContent[0].split(",")[0];
            var dateArr = dateStr.split("-");
            var Ornaments = Ornament.split(";");
            var tdContent = "";
            var AtagContent = '<a class="icon" href="#"><img onclick="spreadMenu(this)" src="menuicon.png" /></a>';
            var Html_kqResult = "<table class='month' border='1'><caption align='center'>" + dateArr[0] + "年" + dateArr[1] + "月考勤信息</caption>";
            Html_kqResult = Html_kqResult + "<tr><th>星期日</th><th>星期一</th><th>星期二</th><th>星期三</th><th>星期四</th><th>星期五</th><th>星期六</th></tr><tr>";
            for (a = 1; a < DaysContent[0].split(",")[1]; a++) {
                Html_kqResult = Html_kqResult + "<td class='previous'></td>";

            }
            for (i = 0; i < DaysContent.length; i++) {
                var DayContent = DaysContent[i].split(",");
                var datevalue = DayContent[0];                          //考勤日期
                var weekday = DayContent[1];                           //周几
                var checkinTime = DayContent[2];                        //上午打卡时间
                var AM_Status = DayContent[3];                          //上午考勤状态
                var AM_ReviseType = DayContent[4];                      //上午修订状态
                var checkoutTime = DayContent[5];                       //下午打卡时间
                var PM_Status = DayContent[6];                          //下午考勤状态
                var PM_ReviseType = DayContent[7];                      //下午修订状态
                var remark = DayContent[8];                             //备注说明     
                var liContent_AM = "<li><span>" + checkinTime + "</span>&nbsp<span>" + AM_Status + "</span>&nbsp<span>" + AM_ReviseType + "</span></li>";
                var liContent_PM = "<li><span>" + checkoutTime + "</span>&nbsp<span>" + PM_Status + "</span>&nbsp<span>" + PM_ReviseType + "</span></li>";
                var isWorkday = Ornaments[i].split(",")[0];
                var reviseDoc1 = Ornaments[i].split(",")[1];
                var reviseDoc2 = Ornaments[i].split(",")[2];
                var reviseDoc3 = Ornaments[i].split(",")[3];
                if (isWorkday == "工作日") {
                    if (AM_ReviseType != "") {
                        if (reviseDoc1 != "")
                            liContent_AM = "<li><span>" + checkinTime + "</span>&nbsp<a href=" + reviseDoc1 + " target=_blank><span>" + AM_ReviseType + "</span></a></li>";
                        else
                            liContent_AM = "<li><span>" + checkinTime + "</span>&nbsp<span>" + AM_ReviseType + "</span></li>";
                    }
                    if ((AM_ReviseType == "" || AM_ReviseType == "旷工") && AM_Status == "缺勤") {
                        liContent_AM = "<li class='important'><span>" + checkinTime + "</span>&nbsp<span>" + AM_Status + "</span></li>";
                    }
                    if (PM_ReviseType != "") {
                        if (reviseDoc2 != "")
                            liContent_PM = "<li><span>" + checkoutTime + "</span>&nbsp<a href=" + reviseDoc2 + " target=_blank><span>" + PM_ReviseType + "</span></a></li>";
                        else
                            liContent_PM = "<li><span>" + checkoutTime + "</span>&nbsp<span>" + PM_ReviseType + "</span></li>";
                    }
                    if ((PM_ReviseType == "" || PM_ReviseType == "旷工") && PM_Status == "缺勤") {
                        liContent_PM = "<li class='important'><span>" + checkoutTime + "</span>&nbsp<span>" + PM_Status + "</span></li>"
                    }
                    tdContent = "<td class='active'><font size='5px'>" + datevalue.split("-")[2] + "</font>" + AtagContent + "<ul>" + liContent_AM + liContent_PM + "</ul></td>";
                }
                else if (isWorkday == "") {
                    tdContent = "<td class='absent'><font size='5px'>" + datevalue.split("-")[2] + "</font>" + AtagContent + "<ul>" + liContent_AM + liContent_PM + "</ul></td>";
                }
                else {
                    tdContent = "<td class='holiday'><font size='5px'>" + datevalue.split("-")[2] + "</font>" + AtagContent + "<ul>" + liContent_AM + liContent_PM + "</ul></td>";
                }


                if (weekday == "1")
                    Html_kqResult = Html_kqResult + "<tr>" + tdContent;
                else if (weekday == "7")
                    Html_kqResult = Html_kqResult + tdContent + "</tr>";
                else
                    Html_kqResult = Html_kqResult + tdContent;
                if (i == (DaysContent.length - 1)) {
                    for (b = 0; b < (7 - weekday); b++) {
                        Html_kqResult += "<td class='next'></td>";
                    }
                    Html_kqResult += "</tr></table>"
                }
            }

            document.getElementById("Calendar").innerHTML = Html_kqResult;


        }

        function spreadMenu(obj) {
            var ie_v = engine;
            object = obj;
            var tdobj = obj.parentNode.parentNode;
            var color = tdobj.style.backgroundColor;
            colorname = color;
            tdobj.style.backgroundColor="#1E90FF";
            if (ie_v > 8 || ie_v == null) {
                createMenu(obj);
            } else {
                obj.src = "+icon2.png";
                createMenu(obj);
                
            }
        }

        function createMenu() {
            var port = window.parent.location.port;
            if (port == "80")
                var host = "http://" + window.parent.location.hostname;
            else
                var host = "http://" + window.parent.location.hostname + ":" + port;

            var urls = new Array();
            var typeNames = new Array("请假", "公出", "出差", "异常/哺乳假", "加班");
            var QJurl = host + "/path/docname.html";
            var GCurl = host + "/path/docname.html";
            var CCurl = host + "/path/docname.html";
            var YCurl = host + "/path/docname.html";
            var JBurl = host + "/path/docname.html";
            urls.push(QJurl, GCurl, CCurl, YCurl, JBurl);
            var tag_a_content = "";
            for (i = 0; i < urls.length; i++) {
                if (tag_a_content == "") {
                    tag_a_content = "<a class='acontent' href='" + urls[i] + "' target=_blank onclick='closeDialog()'><span>"+(i+1)+"&nbsp&nbsp&nbsp&nbsp</span>" + typeNames[i] + "申请</a></br>";
                }
                else {
                    tag_a_content = tag_a_content + "<a class='acontent' href='" + urls[i] + "' target=_blank onclick='closeDialog()'><span>"+(i+1)+"&nbsp&nbsp&nbsp&nbsp</span>" + typeNames[i] + "申请</a></br>";
                }
            }
            var buttonContent = "<input id='close' type='button' onclick='closeDialog()' value='关闭' />"
            var obj_div = document.getElementById("typeSelect");
            obj_div.innerHTML = "<div class='title'>考勤修订类别</div></br></br><div class='divcontent'>"+tag_a_content+"</br></div><div style='text-align:center'>"+buttonContent+"</div>";
            obj_div.style.display = "block";
            document.getElementById("div_bg").style.display = "block";
            
        }

        function closeDialog(){
            document.getElementById("typeSelect").style.display = "none";
            document.getElementById("div_bg").style.display = "none";
            object.parentNode.parentNode.style.backgroundColor=colorname;
        }

        function returnIEVersion() {

            if (window.navigator.appName == "Microsoft Internet Explorer") {
                // This is an IE browser. What mode is the engine in?
                if (document.documentMode) // IE8 or later
                    engine = document.documentMode;
                else // IE 5-7
                {
                    engine = 5; // Assume quirks mode unless proven otherwise
                    if (document.compatMode) {
                        if (document.compatMode == "CSS1Compat")
                            engine = 7; // standards mode
                    }
                    // There is no test for IE6 standards mode because that mode  
                    // was replaced by IE7 standards mode; there is no emulation.
                }
                // the engine variable now contains the document compatibility mode.
            }


        }

    </SCRIPT>

    <SCRIPT language="JavaScript" type="text/javascript">

        document._domino_target = "_self";
        function _doClick(v, o, t, h) {
            var form = document._frmPerMonthQuery_rl;
            if (form.onsubmit) {
                var retVal = form.onsubmit();
                if (typeof retVal == "boolean" && retVal == false)
                    return false;
            }
            var target = document._domino_target;
            if (o.href != null) {
                if (o.target != null)
                    target = o.target;
            } else {
                if (t != null)
                    target = t;
            }
            form.target = target;
            form.__Click.value = v;
            if (h != null)
                form.action += h;
            form.submit();
            return false;
        }

    </SCRIPT>

    <META name="GENERATOR" content="MSHTML 11.00.10570.1001">
</HEAD>

<BODY text="#000000" bgcolor="#ffffff" onload="bodyOnLoad()">
    <FORM name="_frmPerMonthQuery_rl" 
        method="post"><INPUT name="__Click" type="hidden" value="0">
        <DIV id="param" style="display: none;">
            <TABLE border="1">
                <TBODY>
                    <TR valign="top">
                        <TD width="189">
                            <DIV align="center">隐藏域</DIV>
                        </TD>
                        <TD width="302">
                            <DIV align="center">说明</DIV>
                        </TD>
                    </TR>
                    <TR valign="top">
                        <TD width="189">
                            <DIV align="center"><TEXTAREA name="HTMLContent" id="HTMLContent" rows="7" cols="50">2018-09-01,7,,,,,,,;2018-09-02,1,,,,,,,;2018-09-03,2,07:09:23,正常,,19:47:32,正常,,;2018-09-04,3,07:18:00,正常,,19:17:14,正常,,;2018-09-05,4,07:18:24,正常,,17:19:23,正常,,;2018-09-06,5,07:13:08,正常,,17:14:17,正常,,;2018-09-07,6,07:22:58,正常,,17:34:24,正常,,;2018-09-08,7,,,,,,,;2018-09-09,1,,,,,,,;2018-09-10,2,07:17:19,正常,,17:45:04,正常,,;2018-09-11,3,,缺勤,旷工,,缺勤,旷工,;2018-09-12,4,,,,,,,;2018-09-13,5,,,,,,,;2018-09-14,6,,,,,,,;2018-09-15,7,,,,,,,;2018-09-16,1,,,,,,,;2018-09-17,2,,,,,,,;2018-09-18,3,,,,,,,;2018-09-19,4,,,,,,,;2018-09-20,5,,缺勤,旷工,,缺勤,旷工,;2018-09-21,6,,,,,,,;2018-09-22,7,,,,,,,;2018-09-23,1,,,,,,,;2018-09-24,2,,缺勤,旷工,,缺勤,旷工,;2018-09-25,3,,,,,,,;2018-09-26,4,,,,,,,;2018-09-27,5,,,,,,,;2018-09-28,6,,,,,,,;2018-09-29,7,,,,,,,;2018-09-30,1,,,,,,,</TEXTAREA>
                            </DIV>
                        </TD>
                        <TD width="302">
                            <DIV align="center">表格中间内容</DIV>
                        </TD>
                    </TR>
                    <TR valign="top">
                        <TD width="189">
                            <DIV align="center"><TEXTAREA name="Ornament" id="Ornament" rows="7" cols="50">,,,;,,,;工作日,,,;工作日,,,;工作日,,,;工作日,,,;工作日,,,;,,,;,,,;工作日,,,;工作日,,,;,,,;,,,;,,,;,,,;,,,;,,,;,,,;,,,;工作日,,,;,,,;,,,;,,,;工作日,,,;,,,;,,,;,,,;,,,;,,,;,,,</TEXTAREA>
                            </DIV>
                        </TD>
                        <TD width="302">
                            <DIV align="center">工作日和请假加班文档信息</DIV>
                        </TD>
                    </TR>
                    
                    
                    <TR valign="top">
                        <TD width="189"><IMG width="1" height="1" alt="" src="ecblank.gif"
                                border="0"></TD>
                        <TD width="302"><IMG width="1" height="1" alt="" src="ecblank.gif"
                                border="0"></TD>
                    </TR>
                </TBODY>
            </TABLE>
        </DIV>
        <DIV align="center" class="result" id="Calendar"></DIV>
        <DIV class="div-bg" id="div_bg"></DIV>
        <DIV class="typeselect" id="typeSelect"></DIV>
        <CENTER><B>
                <FONT size="2">说明：1、如果迟到或早退超过两小时，则全天记为旷工；</FONT>
            </B></CENTER>
        <CENTER><B>
                <FONT size="2">　　&nbsp;&nbsp;2、出勤天数=正常考勤天数+出差天数+公出天数。</FONT>
            </B></CENTER>
    </FORM>
</BODY>

</HTML>